document.addEventListener("DOMContentLoaded", () => {

    function criarModalLogin() {
        const div = document.createElement("div"); 
        div.className = "modal-overlay";
        div.innerHTML = `
            <div class="modal">
                <div class="modal-header">
                    <h2>Login</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="email" placeholder="E-mail" required>
                    <input type="password" placeholder="Senha" required>
                    <button class="btn btn-login">Entrar</button>
                </div>
            </div>
        `;
        document.body.appendChild(div);
        div.querySelector(".modal-close").addEventListener("click", () => div.remove());
        div.addEventListener("click", e => {
            if (e.target === div) div.remove();
        });

        div.querySelector(".modal-body .btn-login").addEventListener("click", async (event) => {
            event.preventDefault();
            const email = div.querySelector('input[type="email"]').value.trim();
            const senha = div.querySelector('input[type="password"]').value.trim();

            if (!email || !senha) {
                alert("Preencha todos os campos.");
                return;
            }

            try {
                const res = await fetch('https://192.168.1.46:3000/login', {
                    method: 'POST',
                    headers: { 'Content-Type': "application/json" },
                    body: JSON.stringify({ email, senha })
                });

                if (res.status === 200) {
                    alert("Login realizado com sucesso!");
                    div.remove();
                } else {
                    alert("E-mail ou senha invÃ¡lidos.");
                }
            } catch (err) {
                alert("Erro ao conectar com o servidor.");
            }
        });
    }

    const btLogin = document.querySelector(".btn-primary"); 
    if (btLogin) {
        btLogin.addEventListener("click", () => criarModalLogin());
    }
});